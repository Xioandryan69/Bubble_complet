!function(h){h.fn.tagedit=function(r){var d,l,a,n,s,t;function o(){l&&(0!=r.autocompleteOptions.source&&d.find("#tagedit-input").autocomplete("enable"),l.removeClass("tagedit-listelement-focus"),l=null,d.find("#tagedit-input").removeAttr("aria-activedescendant"))}function c(t){t.trigger("finishEdit",[!0]).addClass("tagedit-listelement-deleted").attr("title",r.deletedElementTitle),t.find(":hidden").each(function(){var t=new RegExp("("+r.addedPostfix+"|"+r.deletedPostfix+")?]"),t=h(this).attr("name").replace(t,r.deletedPostfix+"]");h(this).attr("name",t)})}function u(t,e){e=void 0!==e&&e;var i=null,a=1==r.checkNewEntriesCaseSensitive?t:t.toLowerCase(),n=!0;if(d.find("li.tagedit-listelement-old input:hidden").each(function(){(1==r.checkNewEntriesCaseSensitive?h(this).val():h(this).val().toLowerCase())==a&&(n=!1)}),1==n&&1==e&&0!=r.autocompleteOptions.source){var l=[];h.isArray(r.autocompleteOptions.source)?l=r.autocompleteOptions.source:h.isFunction(r.autocompleteOptions.source)?r.autocompleteOptions.source({term:t},function(t){l=t}):"string"==typeof r.autocompleteOptions.source&&((e=r.autocompleteOptions.source).match(/\?/)?e+="&":e+="?",h.ajax({async:!1,url:e+="term="+t,dataType:"json",complete:function(t,e){l=h.parseJSON(t.responseText)}}));for(var s=0;s<l.length;s++){var o=l[s].label||l[s];if((1==r.checkNewEntriesCaseSensitive?o:o.toLowerCase())==a){n=!1,i="string"==typeof l[s]?s:l[s].id;break}}}return new Array(n,i)}r=h.extend(!0,{autocompleteURL:null,checkToDeleteURL:null,deletedPostfix:"-d",addedPostfix:"-a",additionalListClass:"",allowEdit:!0,allowDelete:!0,allowAdd:!0,direction:"ltr",animSpeed:500,autocompleteOptions:{select:function(t,e){return h(this).val(e.item.value).trigger("transformToTag",[e.item.id]),!1}},breakKeyCodes:[13,44],checkNewEntriesCaseSensitive:!1,texts:{removeLinkTitle:"Remove from list.",saveEditLinkTitle:"Save changes.",deleteLinkTitle:"Delete this tag from database.",deleteConfirmation:"Are you sure to delete this entry?",deletedElementTitle:"This Element will be deleted.",breakEditLinkTitle:"Cancel",forceDeleteConfirmation:"There are more records using this tag, are you sure do you want to remove it?"},tabindex:!1},r||{}),0!=this.length&&(r.autocompleteURL&&(r.autocompleteOptions.source=r.autocompleteURL),(t=this.attr("dir"))&&0<t.length&&(r.direction=this.attr("dir")),d=this,l=null,a=new RegExp("^(.*)\\[([0-9]*?("+r.deletedPostfix+"|"+r.addedPostfix+")?)?]$","i"),(n=d.eq(0).attr("name").match(a))&&4==n.length?(n=n[1],!r.tabindex&&(t=d.eq(0).attr("tabindex"))&&(r.tabindex=t),s='<ul class="tagedit-list '+r.additionalListClass+'">',d.each(function(t){var e=h(this).attr("name").match(a);e&&4==e.length&&(0==r.deleteEmptyItems||0<h(this).val().length)&&0<e[1].length&&(e=void 0!==e[2]?e[2]:"",s=(s=(s+='<li class="tagedit-listelement tagedit-listelement-old" aria-labelledby="'+(t="tagedit-"+n+"-"+(e||t))+'">')+'<span dir="'+r.direction+'" id="'+t+'">'+h(this).val()+"</span>")+'<input type="hidden" name="'+n+"["+e+']" value="'+h(this).val()+'" />',r.allowDelete&&(s+='<a class="tagedit-close" title="'+r.texts.removeLinkTitle+'" aria-label="'+r.texts.removeLinkTitle+" "+h(this).val()+'">x</a>'),s+="</li>")}),d.last().after(s),t=d.last().next(),d.remove(),d=t,0<r.deletedPostfix.length&&d.find('input[name$="'+r.deletedPostfix+']"]').each(function(){c(h(this).parent())}),s='<li class="tagedit-listelement tagedit-listelement-new">',r.allowAdd&&(s+='<input type="text" name="'+n+'[]" value="" id="tagedit-input" disabled="disabled" class="tagedit-input-disabled" dir="'+r.direction+'"/>'),s+="</li></ul>",d.append(s).attr("tabindex",r.tabindex).find("#tagedit-input").attr("tabindex",r.tabindex).each(function(){h(this).autoGrowInput({comfortZone:15,minWidth:15,maxWidth:2e4}),h(this).bind("transformToTag",function(t,e){var i=void 0!==e&&(0<e.length||0<e),a=1!=i&&!r.autocompleteOptions.noCheck,a=u(h(this).val(),a);(!0===a[0]||!1===a[0]&&"string"==typeof a[1])&&(0==i&&"string"==typeof a[1]&&(i=!0,e=a[1]),1!=r.allowAdd&&!i||(s='<li class="tagedit-listelement tagedit-listelement-old" aria-labelledby="'+(a="tagedit-"+n+"-"+e)+'">',s+='<span dir="'+r.direction+'" id="'+a+'">'+h(this).val()+"</span>",a=i?n+"["+e+r.addedPostfix+"]":n+"[]",s=(s+='<input type="hidden" name="'+a+'" value="'+h(this).val()+'" />')+'<a class="tagedit-close" title="'+r.texts.removeLinkTitle+'" aria-label="'+r.texts.removeLinkTitle+" "+h(this).val()+'">x</a></li>',h(this).parent().before(s))),h(this).val(""),r.autocompleteOptions.source&&h(this).is(":ui-autocomplete")&&h(this).autocomplete("close")}).keydown(function(t){var e,i,a,n=0<t.keyCode?t.keyCode:t.which;switch(n){case 46:if(!l)break;case 8:if(l)return l.fadeOut(r.animSpeed,function(){h(this).remove()}),o(),t.preventDefault(),!1;if(0==h(this).val().length)return(e=d.find("li.tagedit-listelement-old").last()).fadeOut(r.animSpeed,function(){e.remove()}),t.preventDefault(),!1;break;case 9:if(0<h(this).val().length&&0==h("ul.ui-autocomplete #ui-active-menuitem").length)return h(this).trigger("transformToTag"),t.preventDefault(),!1;break;case 37:case 39:if(0==h(this).val().length)return i=37==n?-1:1,a=d.find("li.tagedit-listelement-old"),x=a.length,next=0,a.each(function(t,e){if(h(e).hasClass("tagedit-listelement-focus"))return x=t,!0}),o(),next=Math.max(0,x+i),a.get(next)&&(l=a.eq(next).addClass("tagedit-listelement-focus"),h(this).attr("aria-activedescendant",l.attr("aria-labelledby")),0!=r.autocompleteOptions.source)&&h(this).autocomplete("close").autocomplete("disable"),t.preventDefault(),!1;break;default:if(null!==l)return t.preventDefault(),t.bubble=!1}return!0}).keypress(function(t){var e=0<t.keyCode?t.keyCode:t.which;return-1<h.inArray(e,r.breakKeyCodes)?(0<h(this).val().length&&0==h("ul.ui-autocomplete #ui-active-menuitem").length&&h(this).trigger("transformToTag"),t.preventDefault(),!1):(0<h(this).val().length&&o(),!0)}).bind("paste",function(t){var e=h(this);"paste"==t.type&&setTimeout(function(){e.trigger("transformToTag")},1)}).blur(function(){var t;0==h(this).val().length?h(this).attr("disabled","disabled").addClass("tagedit-input-disabled"):(t=h(this),h(this).data("blurtimer",window.setTimeout(function(){t.val("")},500))),o(),r.tabindex&&d.attr("tabindex",r.tabindex)}).focus(function(){window.clearTimeout(h(this).data("blurtimer")),d.attr("tabindex","-1")}),0!=r.autocompleteOptions.source&&h(this).autocomplete(r.autocompleteOptions)}).end().click(function(t){switch(t.target.tagName){case"A":h(t.target).parent().fadeOut(r.animSpeed,function(){h(t.target).parent().remove(),d.find("#tagedit-input").focus()});break;case"INPUT":case"SPAN":case"LI":if(0==h(t.target).hasClass("tagedit-listelement-deleted")&&0==h(t.target).parent("li").hasClass("tagedit-listelement-deleted"))return e=t,void(0!=r.allowEdit&&(e="SPAN"==e.target.tagName?h(e.target).parent():h(e.target),n=null,e.bind("finishEdit",function(t,e){window.clearTimeout(n);var i=h(this).find(":text"),a=u(i.val(),!0);return 0<i.val().length&&(void 0===e||!1===e)&&1==a[0]&&(h(this).find(":hidden").val(i.val()),h(this).find("span").html(i.val())),i.remove(),h(this).find("a.tagedit-save, a.tagedit-break, a.tagedit-delete").remove(),h(this).removeClass("tagedit-listelement-edit").unbind("finishEdit"),!1}),i=e.find(":hidden"),html='<input type="text" name="tmpinput" autocomplete="off" value="'+i.val()+'" class="tagedit-edit-input" dir="'+r.direction+'"/>',html=(html+='<a class="tagedit-save" title="'+r.texts.saveEditLinkTitle+'">o</a>')+'<a class="tagedit-break" title="'+r.texts.breakEditLinkTitle+'">x</a>',1==r.allowDelete&&0<e.find(":hidden").length&&void 0!==e.find(":hidden").attr("name").match(a)[3]&&(html+='<a class="tagedit-delete" title="'+r.texts.deleteLinkTitle+'">d</a>'),i.after(html),e.addClass("tagedit-listelement-edit").find("a.tagedit-save").click(function(){return h(this).parent().trigger("finishEdit"),!1}).end().find("a.tagedit-break").click(function(){return h(this).parent().trigger("finishEdit",[!0]),!1}).end().find("a.tagedit-delete").click(function(){var t;return window.clearTimeout(n),confirm(r.texts.deleteConfirmation)&&(!(t=function(t){if(null===r.checkToDeleteURL)return!1;var t=t.find("input:hidden").attr("name"),e=new RegExp("\\d"),t=t.match(e),i=!1;return h.ajax({async:!1,url:r.checkToDeleteURL,dataType:"json",type:"POST",data:{tagId:t},complete:function(t,e){t=h.parseJSON(t.responseText);!0===t.success&&(i=t.allowDelete)}}),i}(h(this).parent()))&&confirm(r.texts.forceDeleteConfirmation)&&c(h(this).parent()),t)&&c(h(this).parent()),h(this).parent().find(":text").trigger("finishEdit",[!0]),!1}).end().find(":text").focus().autoGrowInput({comfortZone:10,minWidth:15,maxWidth:2e4}).keypress(function(t){switch(t.keyCode){case 13:return t.preventDefault(),h(this).parent().trigger("finishEdit"),!1;case 27:return t.preventDefault(),h(this).parent().trigger("finishEdit",[!0]),!1}return!0}).blur(function(){var t=h(this);n=window.setTimeout(function(){t.parent().trigger("finishEdit",[!0])},500)})));default:h(this).find("#tagedit-input").removeAttr("disabled").removeClass("tagedit-input-disabled").focus()}var e,n,i;return!1}).focus(function(t){h(this).click()})):alert("elementname dows not match the expected format (regexp: "+a+")"))}}(jQuery),function(s){s.fn.autoGrowInput=function(l){return l=s.extend({maxWidth:1e3,minWidth:0,comfortZone:70},l),this.filter("input:text").each(function(){function t(){var t;i!==(i=a.val())&&(t=i.replace(/&/g,"&amp;").replace(/\s/g,"&nbsp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),n.html(t),(t=(t=n.width())+l.comfortZone>=e?t+l.comfortZone:e)<a.width()&&e<=t||e<t&&t<l.maxWidth)&&a.width(t)}var e=l.minWidth||s(this).width(),i="",a=s(this),n=s("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:a.css("fontSize"),fontFamily:a.css("fontFamily"),fontWeight:a.css("fontWeight"),letterSpacing:a.css("letterSpacing"),whiteSpace:"nowrap"});n.insertAfter(a),s(this).bind("keyup keydown blur update",t),t()}),this}}(jQuery);
//# sourceMappingURL=jquery.tagedit.min.js.map