!function(){"use strict";function o(){}function i(t){return function(){return t}}function t(t){return t}function n(){return a}var e,r=tinymce.util.Tools.resolve("tinymce.PluginManager"),g=function(t){return e===t},c=i(!1),u=i(!(e=null)),a={fold:function(t,n){return t()},isSome:c,isNone:u,getOr:t,getOrThunk:l,getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},getOrNull:i(null),getOrUndefined:i(void 0),or:t,orThunk:l,map:n,each:o,bind:n,exists:c,forall:u,filter:function(){return a},toArray:function(){return[]},toString:i("none()")};function l(t){return t()}function s(e){function t(){return o}function n(t){return t(e)}var r=i(e),o={fold:function(t,n){return n(e)},isSome:u,isNone:c,getOr:r,getOrThunk:r,getOrDie:r,getOrNull:r,getOrUndefined:r,or:t,orThunk:t,map:function(t){return s(t(e))},each:function(t){t(e)},bind:n,exists:n,forall:n,filter:function(t){return t(e)?o:a},toArray:function(){return[e]},toString:function(){return"some("+e+")"}};return o}function d(t){var n=t;return{get:function(){return n},set:function(t){n=t}}}function f(t,e){return r=function(t,n){return{k:n,v:e(t,n)}},o={},k(t,function(t,n){t=r(t,n);o[t.k]=t.v}),o;var r,o}function m(t,n){return C.call(t,n)}function h(t,n){return-1!==t.indexOf(n)}function v(e,o,t){function r(t){var e={},r=[];k(t,function(t,n){n={title:n,keywords:t.keywords,char:_((n=t).char,"<img")?n.char.replace(/src="([^"]+)"/,function(t,n){return'src="'+a+n+'"'}):n.char,category:z(I,t.category)},t=void 0!==e[n.category]?e[n.category]:[];e[n.category]=t.concat([n]),r.push(n)}),c.set(e),n.set(r)}function i(){return n.get().getOr([])}function u(){return c.isSet()&&n.isSet()}var c=A(),n=A(),a=L(e);return e.on("init",function(){T.load(t,o).then(function(t){var n=M(e);r(j(t,n))},function(t){console.log("Failed to load emoticons: "+t),c.set({}),n.set([])})}),{listCategories:function(){return[E].concat(O(c.get().getOr({})))},hasLoaded:u,waitForLoad:function(){return u()?P.resolve(!0):new P(function(t,n){var e=15,r=x.setInterval(function(){u()?(x.clearInterval(r),t(!0)):--e<0&&(console.log("Could not load emojis from url: "+o),x.clearInterval(r),n(!1))},100)})},listAll:i,listCategory:function(n){return n===E?i():c.get().bind(function(t){return p.from(t[n])}).getOr([])}}}var y,p={some:s,none:n,from:function(t){return null==t?a:s(t)}},b=function(t,n){for(var e=0,r=t.length;e<r;e++)n(t[e],e)},w=function(){return(w=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},O=Object.keys,C=Object.hasOwnProperty,k=function(t,n){for(var e=O(t),r=0,o=e.length;r<o;r++){var i=e[r];n(t[i],i)}},j=(y=function(t,n){return n},function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(0===t.length)throw new Error("Can't merge zero objects");for(var e={},r=0;r<t.length;r++){var o,i=t[r];for(o in i)m(i,o)&&(e[o]=y(e[o],i[o]))}return e}),A=function(){t=o,n=d(p.none());var t,n,e={clear:function(){r(),n.set(p.none())},isSet:function(){return n.get().isSome()},get:function(){return n.get()},set:function(t){r(),n.set(p.some(t))}};function r(){n.get().each(t)}return w(w({},e),{on:function(t){return e.get().each(t)}})},_=function(t,n){return t=t,e=0,""===(n=n)||t.length>=n.length&&t.substr(e,e+n.length)===n;var e},T=tinymce.util.Tools.resolve("tinymce.Resource"),x=tinymce.util.Tools.resolve("tinymce.util.Delay"),P=tinymce.util.Tools.resolve("tinymce.util.Promise"),D="tinymce.plugins.emoticons",S=function(t){return t.getParam("emoticons_database","emojis","string")},L=function(t){return t.getParam("emoticons_images_url","https://twemoji.maxcdn.com/v/13.0.1/72x72/","string")},E="All",I={symbols:"Symbols",people:"People",animals_and_nature:"Animals and Nature",food_and_drink:"Food and Drink",activity:"Activity",travel_and_places:"Travel and Places",objects:"Objects",flags:"Flags",user:"User Defined"},z=function(t,n){return m(t,n)?t[n]:n},M=function(t){t=t.getParam("emoticons_append",{},"object");return f(t,function(t){return w({keywords:[],category:"user"},t)})},F=function(t,n,e){for(var r=[],o=n.toLowerCase(),i=e.fold(function(){return c},function(n){return function(t){return n<=t}}),u=0;u<t.length&&(0!==n.length&&!function(t,n){return h(t.title.toLowerCase(),n)||function(t,n){for(var e=0,r=t.length;e<r;e++)if(n(t[e],e))return!0;return!1}(t.keywords,function(t){return h(t.toLowerCase(),n)})}(t[u],o)||(r.push({value:t[u].char,text:t[u].title,icon:t[u].char}),!i(r.length)));u++);return r},N="pattern",U=function(e,o){var r,i,u,t={pattern:"",results:F(o.listAll(),"",p.some(300))},c=d(E),a=(r=function(t){var n,e,r;n=(t=t).getData(),e=c.get(),r=o.listCategory(e),r=F(r,n[N],e===E?p.some(300):p.none()),t.setData({results:r})},i=200,u=null,{cancel:l,throttle:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];l(),u=setTimeout(function(){u=null,r.apply(null,t)},i)}});function l(){g(u)||(clearTimeout(u),u=null)}function n(){return{title:"Emoticons",size:"normal",body:{type:"tabpanel",tabs:function(t,n){for(var e=t.length,r=new Array(e),o=0;o<e;o++){var i=t[o];r[o]=n(i,o)}return r}(o.listCategories(),function(t){return{title:t,name:t,items:[s,f]}})},initialData:t,onTabChange:function(t,n){c.set(n.newTabName),a.throttle(t)},onChange:a.throttle,onAction:function(t,n){"results"===n.name&&(n=n.value,e.insertContent(n),t.close())},buttons:[{type:"cancel",text:"Close",primary:!0}]}}var s={label:"Search",type:"input",name:N},f={type:"collection",name:"results"},m=e.windowManager.open(n());m.focus(N),o.hasLoaded()||(m.block("Loading emoticons..."),o.waitForLoad().then(function(){m.redial(n()),a.throttle(m),m.focus(N),m.unblock()}).catch(function(t){m.redial({title:"Emoticons",body:{type:"panel",items:[{type:"alertbanner",level:"error",icon:"warning",text:"<p>Could not load emoticons</p>"}]},buttons:[{type:"cancel",text:"Close",primary:!0}],initialData:{pattern:"",results:[]}}),m.focus(N),m.unblock()}))};r.add("emoticons",function(t,n){n=n,a=S(l=t);var e,r,o,i,u,c,n=l.getParam("emoticons_database_url",n+"/js/"+a+l.suffix+".js","string"),a=t.getParam("emoticons_database_id",D,"string"),l=v(t,n,a);function s(){return o.execCommand("mceEmoticons")}r=l,(e=t).addCommand("mceEmoticons",function(){return U(e,r)}),(o=t).ui.registry.addButton("emoticons",{tooltip:"Emoticons",icon:"emoji",onAction:s}),o.ui.registry.addMenuItem("emoticons",{text:"Emoticons...",icon:"emoji",onAction:s}),u=l,(i=t).ui.registry.addAutocompleter("emoticons",{ch:":",columns:"auto",minChars:2,fetch:function(n,e){return u.waitForLoad().then(function(){var t=u.listAll();return F(t,n,p.some(e))})},onAction:function(t,n,e){i.selection.setRng(n),i.insertContent(e),t.hide()}}),(c=t).on("PreInit",function(){c.parser.addAttributeFilter("data-emoticon",function(t){b(t,function(t){t.attr("data-mce-resize","false"),t.attr("data-mce-placeholder","1")})})})})}();