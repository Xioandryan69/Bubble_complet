!function(){"use strict";function s(t){var e=t;return{get:function(){return e},set:function(t){e=t}}}function m(t){return!(null==t)}function n(){}function a(t){return function(){return t}}function t(t){return t}function e(){return u}var r,o,F=tinymce.util.Tools.resolve("tinymce.PluginManager"),f=tinymce.util.Tools.resolve("tinymce.util.Tools"),c=(r="array",function(t){return e=typeof(t=t),(null===t?"null":"object"==e&&(Array.prototype.isPrototypeOf(t)||t.constructor&&"Array"===t.constructor.name)?"array":"object"==e&&(String.prototype.isPrototypeOf(t)||t.constructor&&"String"===t.constructor.name)?"string":e)===r;var e}),L=function(t){return typeof t===o},l=a(!(o="function")),i=a(!0),u={fold:function(t,e){return t()},isSome:l,isNone:i,getOr:t,getOrThunk:d,getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},getOrNull:a(null),getOrUndefined:a(void 0),or:t,orThunk:d,map:e,each:n,bind:e,exists:l,forall:i,filter:function(){return u},toArray:function(){return[]},toString:a("none()")};function d(t){return t()}function h(n){function t(){return o}function e(t){return t(n)}var r=a(n),o={fold:function(t,e){return e(n)},isSome:i,isNone:l,getOr:r,getOrThunk:r,getOrDie:r,getOrNull:r,getOrUndefined:r,or:t,orThunk:t,map:function(t){return h(t(n))},each:function(t){t(n)},bind:e,exists:e,forall:e,filter:function(t){return t(n)?o:u},toArray:function(){return[n]},toString:function(){return"some("+n+")"}};return o}function B(t){var e=A(t.width,t.height);return j(e).drawImage(t,0,0),e}function g(u){return new U(function(t,e){function n(){a(),t(i)}function r(){a(),e("Unable to load data of type "+u.type+": "+o)}var o=URL.createObjectURL(u),i=new Image,a=function(){i.removeEventListener("load",n),i.removeEventListener("error",r)};i.addEventListener("load",n),i.addEventListener("error",r),i.src=o,i.complete&&setTimeout(n,0)})}function p(n){return new U(function(t,e){pt(n).fold(function(){e("uri is not base64: "+n)},t)})}function v(t,r,o){return r=r||"image/png",L(HTMLCanvasElement.prototype.toBlob)?new U(function(e,n){t.toBlob(function(t){t?e(t):n()},r,o)}):p(t.toDataURL(r,o))}function N(t){return g(t).then(function(t){URL.revokeObjectURL(t.src);var e=A((e=t).naturalWidth||e.width,(e=t).naturalHeight||e.height);return j(e).drawImage(t,0,0),e})}function D(t){var r;return 0===(t=t.src).indexOf("data:")?p(t):(r=t,new U(function(t,n){var e=new XMLHttpRequest;e.open("GET",r,!0),e.responseType="blob",e.onload=function(){200===this.status&&t(this.response)},e.onerror=function(){var t,e=this;n(0===this.status?((t=new Error("No access to download image")).code=18,t.name="SecurityError",t):new Error("Error "+e.status+" downloading image"))},e.send()}))}function y(t,e){for(var n=t,r=e,o=l,i=0,a=n.length;i<a;i++){var u=n[i];if(r(u,i))return x(u);if(o(u,i))break}return R()}function w(t,e,n){function r(e,n){return t.then(function(t){return t.toDataURL(e||"image/png",n)})}var o=e.type,o=a(o),i=a(n);return{getType:o,toBlob:function(){return U.resolve(e)},toDataURL:i,toBase64:function(){return n.split(",")[1]},toAdjustedBlob:function(e,n){return t.then(function(t){return v(t,e,n)})},toAdjustedDataURL:r,toAdjustedBase64:function(t,e){return r(t,e).then(function(t){return t.split(",")[1]})},toCanvas:function(){return t.then(B)}}}function H(i,a){return i.toCanvas().then(function(t){var e=i.getType(),n=a,r=A(t.width,t.height),o=j(r);"v"===n?(o.scale(1,-1),o.drawImage(t,0,-r.height)):(o.scale(-1,1),o.drawImage(t,-r.width,0));return _t(r,e)})}function z(s,f){return s.toCanvas().then(function(t){return t=t,e=s.getType(),n=((n=f)<0?360+n:n)*Math.PI/180,r=t.width,o=t.height,a=Math.sin(n),u=Math.cos(n),i=Et(Math.abs(r*u)+Math.abs(o*a)),a=Et(Math.abs(r*a)+Math.abs(o*u)),u=A(i,a),(c=j(u)).translate(i/2,a/2),c.rotate(n),c.drawImage(t,-r/2,-o/2),_t(u,e);var e,n,r,o,i,a,u,c})}function b(c,s,f){return void 0===f&&(f=!1),new U(function(t){for(var n=new XMLHttpRequest,e=(n.onreadystatechange=function(){4===n.readyState&&t({status:n.status,blob:n.response})},n.open("GET",c,!0),n.withCredentials=f,s),r=function(t,e){n.setRequestHeader(e,t)},o=O(e),i=0,a=o.length;i<a;i++){var u=o[i];r(e[u],u)}n.responseType="blob",n.send()})}function q(t,e){var n,r;return n=function(t,e){return m(t)?t[e]:void 0},r=t,S(e,function(t,e){r=n(r,t,e)}),mt(r)}function _(t){e=t;var e,t="ImageProxy HTTP error: "+y(It,function(t){return e===t.code}).fold(a("Unknown ImageProxy error"),function(t){return t.message});return U.reject(t)}function W(e){return y(xt,function(t){return t.type===e}).fold(a("Unknown service error"),function(t){return t.message})}function $(t){return"ImageProxy Service error: "+function(t){try{return x(JSON.parse(t))}catch(t){return R()}}(t).bind(function(t){return q(t,["error","type"]).map(W)}).getOr("Invalid JSON in service error message")}function V(t){return r=t,new U(function(t,e){var n=new FileReader;n.onload=function(){t(n.result)},n.onerror=function(t){e(t)},n.readAsText(r)}).then(function(t){t=$(t);return U.reject(t)});var r}function E(t){return t<200||300<=t}function G(t,e){var n,r={"Content-Type":"application/json;charset=UTF-8","tiny-api-key":e};return b((e=e,n=-1===(t=t).indexOf("?")?"?":"&",/[?&]apiKey=/.test(t)?t:t+n+"apiKey="+encodeURIComponent(e)),r).then(function(t){return E(t.status)?(e=t.status,n=t.blob,r=e,"application/json"!==(null==(o=n)?void 0:o.type)||400!==r&&403!==r&&404!==r&&500!==r?_(e):V(n)):U.resolve(t.blob);var e,n,r,o})}function I(t,e,n){return void 0===n&&(n=!1),e?G(t,e):b(t,{},n).then(function(t){return E(t.status)?_(t.status):U.resolve(t.blob)})}function J(e){return n=e,new U(function(t){var e=new FileReader;e.onloadend=function(){t(e.result)},e.readAsDataURL(n)}).then(function(t){return w(N(e),e,t)});var n}function K(t){if(null==t)throw new Error("Node cannot be null or undefined");return{dom:t}}function X(t,n){return e=function(t){var e=n;if(1!==(t=t.dom).nodeType)return!1;if(void 0!==t.matches)return t.matches(e);if(void 0!==t.msMatchesSelector)return t.msMatchesSelector(e);if(void 0!==t.webkitMatchesSelector)return t.webkitMatchesSelector(e);if(void 0!==t.mozMatchesSelector)return t.mozMatchesSelector(e);throw new Error("Browser lacks native selectors")},y(t.dom.childNodes,function(t){return e(P(t))}).map(P);var e}function Q(t){return t.getParam("imagetools_proxy")}function Y(t){function e(t){return/^[0-9\.]+px$/.test(t)}var n=t.style.width,r=t.style.height;return n||r?e(n)&&e(r)?{w:parseInt(n,10),h:parseInt(r,10)}:null:(n=t.width,r=t.height,n&&r?{w:parseInt(n,10),h:parseInt(r,10)}:null)}function Z(t){return{w:t.naturalWidth,h:t.naturalHeight}}function tt(t){return X(P(t),"img")}function et(t,e){return t.dom.is(e,"figure")}function nt(t,e){return t.dom.is(e,"img:not([data-mce-object],[data-mce-placeholder])")}function rt(t,e){t.notificationManager.open({text:e,type:"error"})}function ot(t,e,n){return e=e.match(/(?:\/|^)(([^\/\?]+)\.(?:[a-z0-9.]+))(?:\?|$)/i),m(e)?t.dom.encode(e[n]):null}function it(t,e){return 0===(e=e.src).indexOf("data:")||0===e.indexOf("blob:")||new k(e).host===t.documentBaseURI.host}function at(t,e){return-1!==f.inArray(At(t),new k(e.src).host)}function ut(t,e){var n;return at(t,e)?I(e.src,null,(n=e,-1!==f.inArray(t.getParam("imagetools_credentials_hosts",[],"string[]"),new k(n.src).host))):it(t,e)?D(e):(e=(n=Q(t))+(-1===n.indexOf("?")?"?":"&")+"url="+encodeURIComponent(e.src),t=t.getParam("api_key",t.getParam("imagetools_api_key","","string"),"string"),I(e,t,!1))}function ct(t,e){return mt(t.getParam("imagetools_fetch_image",null,"function")).fold(function(){return ut(t,e)},function(t){return t(e)})}function st(t,e){var n=t.editorUpload.blobCache.getByUri(e.src);return n?Tt.resolve(n.blob()):ct(t,e)}function ft(u,c,s,f,l,d,h){return s.toBlob().then(function(t){var e,n,o,r=u.editorUpload.blobCache,i=d.src,a=c.type===t.type;return u.getParam("images_reuse_filename",!1,"boolean")&&(o=r.getByUri(i),n=m(o)?(i=o.uri(),e=o.name(),o.filename()):(e=ot(u,i,2),ot(u,i,1))),o=r.create({id:"imagetools"+jt++,blob:t,base64:s.toBase64(),uri:i,name:e,filename:a?n:void 0}),r.add(o),u.undoManager.transact(function(){var r=function(){var t,e,n;u.$(d).off("load",r),u.nodeChanged(),f?u.editorUpload.uploadImagesAuto():(St(l),t=u,e=l,n=Rt.setEditorTimeout(t,function(){t.editorUpload.uploadImagesAuto()},t.getParam("images_upload_timeout",3e4,"number")),e.set(n))};u.$(d).on("load",r),h&&u.$(d).attr({width:h.w,height:h.h}),u.$(d).attr({src:o.blobUri()}).removeAttr("data-mce-src")}),o})}function lt(r,o,t,i){return function(){return C(r).fold(function(){rt(r,"Could not find selected image")},function(n){return r._scanForImages().then(function(){return st(r,n.dom)}).then(function(e){return J(e).then(t).then(function(t){return ft(r,e,t,!1,o,n.dom,i)})}).catch(function(t){rt(r,t)})})}}function dt(e,n,i,a,u){vt(u).then(function(t){var e,n,r,o=Z(t);return a.w===o.w&&a.h===o.h||Y(i)&&(e=i,o=o)&&(n=e.style.width,r=e.style.height,(n||r)&&(e.style.width=o.w+"px",e.style.height=o.h+"px",e.removeAttribute("data-mce-style")),n=e.width,r=e.height,n||r)&&(e.setAttribute("width",String(o.w)),e.setAttribute("height",String(o.h))),URL.revokeObjectURL(t.src),u}).then(J).then(function(t){return ft(e,u,t,!0,n,i)})}function ht(e){function n(t){return function(){return e.execCommand(t)}}function t(){return C(e).exists(function(t){return M(e,t.dom).isSome()})}function r(e){function n(t){return e.setDisabled(!t)}return n(t()),o=o.concat([n]),function(){o=bt(o,function(t){return t!==n})}}var o=[];e.on("NodeChange",function(){var e=t();S(o,function(t){return t(e)})}),e.ui.registry.addButton("rotateleft",{tooltip:"Rotate counterclockwise",icon:"rotate-left",onAction:n("mceImageRotateLeft"),onSetup:r}),e.ui.registry.addButton("rotateright",{tooltip:"Rotate clockwise",icon:"rotate-right",onAction:n("mceImageRotateRight"),onSetup:r}),e.ui.registry.addButton("flipv",{tooltip:"Flip vertically",icon:"flip-vertically",onAction:n("mceImageFlipVertical"),onSetup:r}),e.ui.registry.addButton("fliph",{tooltip:"Flip horizontally",icon:"flip-horizontally",onAction:n("mceImageFlipHorizontal"),onSetup:r}),e.ui.registry.addButton("editimage",{tooltip:"Edit image",icon:"edit-image",onAction:n("mceEditImage"),onSetup:r}),e.ui.registry.addButton("imageoptions",{tooltip:"Image options",icon:"image",onAction:n("mceImage")}),e.ui.registry.addContextMenu("imagetools",{update:function(t){return M(e,t).map(function(t){return{text:"Edit image",icon:"edit-image",onAction:n("mceEditImage")}}).toArray()}})}var x=h,R=e,mt=function(t){return null==t?u:h(t)},gt={},T={exports:gt},U=(!function(t){var e,n;e=this,n=function(){var e,t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n={exports:{}};function r(){}function i(t){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],f(t,this)}function o(n,r){for(;3===n._state;)n=n._value;0===n._state?n._deferreds.push(r):(n._handled=!0,i._immediateFn(function(){var t,e=1===n._state?r.onFulfilled:r.onRejected;if(null===e)(1===n._state?a:u)(r.promise,n._value);else{try{t=e(n._value)}catch(t){return void u(r.promise,t)}a(r.promise,t)}}))}function a(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if(t instanceof i)return e._state=3,e._value=t,void c(e);if("function"==typeof n)return void f((r=n,o=t,function(){r.apply(o,arguments)}),e)}e._state=1,e._value=t,c(e)}catch(t){u(e,t)}var r,o}function u(t,e){t._state=2,t._value=e,c(t)}function c(t){2===t._state&&0===t._deferreds.length&&i._immediateFn(function(){t._handled||i._unhandledRejectionFn(t._value)});for(var e=0,n=t._deferreds.length;e<n;e++)o(t,t._deferreds[e]);t._deferreds=null}function s(t,e,n){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=n}function f(t,e){var n=!1;try{t(function(t){n||(n=!0,a(e,t))},function(t){n||(n=!0,u(e,t))})}catch(t){n||(n=!0,u(e,t))}}l=n,t=t,e=setTimeout,i.prototype.catch=function(t){return this.then(null,t)},i.prototype.then=function(t,e){var n=new this.constructor(r);return o(this,new s(t,e,n)),n},i.all=function(t){var u=Array.prototype.slice.call(t);return new i(function(o,i){if(0===u.length)return o([]);var a=u.length;for(var t=0;t<u.length;t++)!function e(n,t){try{if(t&&("object"==typeof t||"function"==typeof t)){var r=t.then;if("function"==typeof r)return void r.call(t,function(t){e(n,t)},i)}u[n]=t,0==--a&&o(u)}catch(t){i(t)}}(t,u[t])})},i.resolve=function(e){return e&&"object"==typeof e&&e.constructor===i?e:new i(function(t){t(e)})},i.reject=function(n){return new i(function(t,e){e(n)})},i.race=function(o){return new i(function(t,e){for(var n=0,r=o.length;n<r;n++)o[n].then(t,e)})},i._immediateFn="function"==typeof setImmediate?function(t){setImmediate(t)}:function(t){e(t,0)},i._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)},i._setImmediateFn=function(t){i._immediateFn=t},i._setUnhandledRejectionFn=function(t){i._unhandledRejectionFn=t},l.exports?l.exports=i:t.Promise||(t.Promise=i);var l=n.exports;return{boltExport:("undefined"!=typeof window?window:Function("return this;")()).Promise||l}},"object"==typeof gt&&void 0!==T?T.exports=n():"function"==typeof t&&t.amd?t(n):(e="undefined"!=typeof globalThis?globalThis:e||self).EphoxContactWrapper=n()}(void 0),T.exports.boltExport),A=function(t,e){return n=document.createElement("canvas"),e=e,n.width=t,n.height=e,n;var n},j=function(t){return t.getContext("2d")},pt=function(t){var t=t.split(","),e=/data:([^;]+)/.exec(t[0]);if(!e)return R();for(var e=e[1],t=t[1],n=atob(t),r=n.length,o=Math.ceil(r/1024),i=new Array(o),a=0;a<o;++a){for(var u=1024*a,c=Math.min(1024+u,r),s=new Array(c-u),f=u,l=0;f<c;++l,++f)s[l]=n[f].charCodeAt(0);i[a]=new Uint8Array(s)}return x(new Blob(i,{type:e}))},vt=g,yt=Array.prototype.indexOf,wt=function(t,e){return yt.call(t,e)},S=function(t,e){for(var n=0,r=t.length;n<r;n++)e(t[n],n)},bt=function(t,e){for(var n=[],r=0,o=t.length;r<o;r++){var i=t[r];e(i,r)&&n.push(i)}return n},O=Object.keys,_t=(function(a){if(!c(a))throw new Error("cases must be an array");if(0===a.length)throw new Error("there must be at least one case");var u=[],n={};return S(a,function(t,r){var e=O(t);if(1!==e.length)throw new Error("one and only one name per case");var o=e[0],i=t[o];if(void 0!==n[o])throw new Error("duplicate key detected:"+o);if("cata"===o)throw new Error("cannot have a case named cata (sorry)");if(!c(i))throw new Error("case arguments must be an array");u.push(o),n[o]=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];var e=n.length;if(e!==i.length)throw new Error("Wrong number of arguments to case "+o+". Expected "+i.length+" ("+i+"), got "+e);return{fold:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(t.length!==a.length)throw new Error("Wrong number of arguments to fold. Expected "+a.length+", got "+t.length);return t[r].apply(null,n)},match:function(t){var e=O(t);if(u.length!==e.length)throw new Error("Wrong number of arguments to match. Expected: "+u.join(",")+"\nActual: "+e.join(","));if(function(t,e){for(var n=0,r=t.length;n<r;++n)if(!0!==e(t[n],n))return!1;return!0}(u,function(t){return-1<wt(e,t)}))return t[o].apply(null,n);throw new Error("Not all branches were specified when using match. Specified: "+e.join(", ")+"\nRequired: "+u.join(", "))},log:function(t){console.log(t,{constructors:u,constructor:o,params:n})}}}}),n}([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]),function(e,t){return v(e,t).then(function(t){return w(U.resolve(e),t,e.toDataURL())})}),Et=function(t,e){void 0===e&&(e=2);e=Math.pow(10,e),t=Math.round(t*e);return Math.ceil(t/e)},It=[{code:404,message:"Could not find Image Proxy"},{code:403,message:"Rejected request"},{code:0,message:"Incorrect Image Proxy URL"}],xt=[{type:"not_found",message:"Failed to load image."},{type:"key_missing",message:"The request did not include an api key."},{type:"key_not_found",message:"The provided api key could not be found."},{type:"domain_not_trusted",message:"The api key is not valid for the request origins."}],P=K,Rt=("undefined"==typeof window&&Function("return this;")(),tinymce.util.Tools.resolve("tinymce.util.Delay")),Tt=tinymce.util.Tools.resolve("tinymce.util.Promise"),k=tinymce.util.Tools.resolve("tinymce.util.URI"),Ut=function(t){return t.getParam("imagetools_toolbar","rotateleft rotateright flipv fliph editimage imageoptions")},At=function(t){return t.getParam("imagetools_cors_hosts",[],"string[]")},jt=0,M=function(e,t){function n(t){return nt(e,t)&&(it(e,t)||at(e,t)||m(Q(e)))}return et(e,t)?tt(t).bind(function(t){return n(t.dom)?x(t.dom):R()}):n(t)?x(t):R()},C=function(t){var e=t.selection.getNode(),n=t.dom.getParent(e,"figure.image");return null!==n&&et(t,n)?tt(n):nt(t,e)?x(P(e)):R()},St=function(t){Rt.clearTimeout(t.get())},Ot=function(e,n,r){return function(){var t=C(e).map(function(t){t=Y(t.dom);return t?{w:t.h,h:t.w}:null}).getOrNull();return lt(e,n,function(t){return z(t,r)},t)()}},Pt=function(t,e,n){return function(){return lt(t,e,function(t){return H(t,n)})()}},kt=function(i,a){return function(){var r=C(i),o=r.map(function(t){return Z(t.dom)});r.each(function(e){M(i,e.dom).each(function(t){st(i,e.dom).then(function(t){t={blob:t,url:URL.createObjectURL(t)};i.windowManager.open({title:"Edit Image",size:"large",body:{type:"panel",items:[{type:"imagetools",name:"imagetools",label:"Edit Image",currentState:t}]},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0,disabled:!0}],onSubmit:function(t){var n=t.getData().imagetools.blob;r.each(function(e){o.each(function(t){dt(i,a,e.dom,t,n)})}),t.close()},onCancel:n,onAction:function(t,e){switch(e.name){case"save-state":e.value?t.enable("save"):t.disable("save");break;case"disable":t.disable("save"),t.disable("cancel");break;case"enable":t.enable("cancel")}}})})})})}};F.add("imagetools",function(t){var n,e,r,o,i,a,u=s(0),c=s(null);n=t,e=u,f.each({mceImageRotateLeft:Ot(n,e,-90),mceImageRotateRight:Ot(n,e,90),mceImageFlipVertical:Pt(n,e,"v"),mceImageFlipHorizontal:Pt(n,e,"h"),mceEditImage:kt(n,e)},function(t,e){n.addCommand(e,t)}),ht(t),(r=t).ui.registry.addContextToolbar("imagetools",{items:Ut(r),predicate:function(t){return M(r,t).isSome()},position:"node",scope:"node"}),i=u,a=c,(o=t).on("NodeChange",function(t){var e=a.get(),t=M(o,t.element);e&&!t.exists(function(t){return e.src===t.src})&&(St(i),o.editorUpload.uploadImagesAuto(),a.set(null)),t.each(a.set)})})}();