!function(){"use strict";function t(e){return function(t){return n=typeof(t=t),(null===t?"null":"object"==n&&(Array.prototype.isPrototypeOf(t)||t.constructor&&"Array"===t.constructor.name)?"array":"object"==n&&(String.prototype.isPrototypeOf(t)||t.constructor&&"String"===t.constructor.name)?"string":n)===e;var n}}function n(n){return function(t){return typeof t===n}}function i(t){return function(){return t}}function e(t){return t}function r(){return f}var o,U=tinymce.util.Tools.resolve("tinymce.PluginManager"),B=tinymce.util.Tools.resolve("tinymce.util.VK"),u=t("string"),a=t("array"),I=function(t){return o===t},K=n("boolean"),z=n("function"),s=function(){},j=function(t,n){return t===n},l=i(!1),c=i(!(o=null)),f={fold:function(t,n){return t()},isSome:l,isNone:c,getOr:e,getOrThunk:m,getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},getOrNull:i(null),getOrUndefined:i(void 0),or:e,orThunk:m,map:r,each:s,bind:r,exists:l,forall:c,filter:function(){return f},toArray:function(){return[]},toString:i("none()")};function m(t){return t()}function g(e){function t(){return o}function n(t){return t(e)}var r=i(e),o={fold:function(t,n){return n(e)},isSome:c,isNone:l,getOr:r,getOrThunk:r,getOrDie:r,getOrNull:r,getOrUndefined:r,or:t,orThunk:t,map:function(t){return g(t(e))},each:function(t){t(e)},bind:n,exists:n,forall:n,filter:function(t){return t(e)?o:f},toArray:function(){return[e]},toString:function(){return"some("+e+")"}};return o}function d(t,n){for(var e=0;e<t.length;e++){var r=n(t[e],e);if(r.isSome())return r}return O.none()}function h(t,n,e){return void 0===e&&(e=j),t.exists(function(t){return e(t,n)})}function p(t,n){return t?O.some(n):O.none()}function v(t){return t=t.getParam("link_assume_external_targets",!1),K(t)&&t?1:!u(t)||"http"!==t&&"https"!==t?0:t}function y(t){return t.getParam("default_link_target")}function V(t){return t.getParam("target_list",!0)}function q(t){return t.getParam("rel_list",[],"array")}function F(t){return t.getParam("allow_unsafe_link_target",!1,"boolean")}function W(n){return void 0===n&&(n=C),function(t){return O.from(t).map(function(t){return dt(t,n)})}}function H(t,e,r,o){for(var n=t,i=function(t,n){(e(t,n)?r:o)(t,n)},u=ht(n),a=0,l=u.length;a<l;a++){var c=u[a];i(n[c],c)}}function k(t,n){return pt.call(t,n)}function G(t){return t&&"a"===t.nodeName.toLowerCase()}function J(t){return G(t)&&!!T(t)}function X(t,n){if(t.collapsed)return[];for(var t=t.cloneContents(),e=new vt(t.firstChild,t),r=[],o=t.firstChild;n(o)&&r.push(o),o=e.next(););return r}function $(t,n){function e(t){return t.filter(function(t){return-1===w.inArray(r,t)})}var r=["noopener"],t=t?t.split(/\s+/):[];return 0<(n=n?0<(n=e(n=t)).length?n.concat(r):r:e(t)).length?w.trim(n.sort().join(" ")):""}function x(t){return t&&"FIGURE"===t.nodeName&&/\bimage\b/i.test(t.className)}function Q(t,n){var e,n=A({},n);return 0<q(t).length||!1!==F(t)||(e=$(n.rel,"_blank"===n.target),n.rel=e||null),O.from(n.target).isNone()&&!1===V(t)&&(n.target=y(t)),n.href=(e=n.href,"http"!==(t=v(t))&&"https"!==t||kt(e)?e:t+"://"+e),n}function Y(a,l,c){var f=a.selection.getNode(),s=P(a,f),m=Q(a,function(t){for(var n=["title","rel","class","target"],e=function(n,e){return t[e].each(function(t){n[e]=0<t.length?t:null}),n},r={href:t.href},o=n,i=function(t,n){r=e(r,t,n)},u=0,a=o.length;u<a;u++)i(o[u],u);return r}(c));a.undoManager.transact(function(){if(c.href===l.href&&l.attach(),s)a.focus(),o=a,u=s,t=c.text,e=m,t.each(function(t){k(u,"innerText")?u.innerText=t:u.textContent=t}),o.dom.setAttribs(u,e),o.selection.select(u);else{var n=a,t=f,e=c.text,r=m;if(x(t)){var o=n,i=r,t=o.dom.select("img",t)[0];if(t){o=o.dom.create("a",i);t.parentNode.insertBefore(o,t);o.appendChild(t)}}else e.fold(function(){n.execCommand("mceInsertLink",!1,r)},function(t){n.insertContent(n.dom.createHTML("a",r,n.dom.encode(t)))})}var o,u,t,e})}function Z(u){u.undoManager.transact(function(){var t,n,e,r=u.selection.getNode();if(x(r)){var o=u,i=o.dom.select("img",r)[0];if(i){var r=o.dom.getParents(i,"a[href]",r)[0];if(r){r.parentNode.insertBefore(i,r);o.dom.remove(r)}}}else o=(i=u).dom,r=i.selection,t=r.getBookmark(),n=r.getRng().cloneRange(),e=o.getParent(n.startContainer,"a[href]",i.getBody()),o=o.getParent(n.endContainer,"a[href]",i.getBody()),e&&n.setStartBefore(e),o&&n.setEndAfter(o),r.setRng(n),i.execCommand("unlink"),r.moveToBookmark(t);u.focus()})}function tt(t){var e,n=t.class,r=t.href,o=t.rel,i=t.target,u=t.text,t=t.title;return n={class:n.getOrNull(),href:r,rel:o.getOrNull(),target:i.getOrNull(),text:u.getOrNull(),title:t.getOrNull()},H(n,function(t,n){return!1===I(t)},(e=r={},function(t,n){e[n]=t}),s),r}function nt(t){return k(t=t,n="items")&&void 0!==t[n]&&null!==t[n];var n}function et(n,t,e,r){var r=r[t],o=0<n.length;return void 0!==r?Ct(r,e).map(function(t){return{url:{value:t.value,meta:{text:o?n:t.text,attach:s}},text:o?n:t.text}}):O.none()}function rt(t){var n=t.href;return 0<n.indexOf("@")&&-1===n.indexOf("/")&&-1===n.indexOf("mailto:")?O.some({message:"The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?",preprocess:function(t){return A(A({},t),{href:"mailto:"+n})}}):O.none()}function ot(f){var t,n;n=P(t=f),Mt(t,n).then(function(t){var o,i,n,e,r,u,a,l,c;return n=function(t){var n,e,r=t.getData();r.url.value?(n={href:r.url.value,text:(n=function(n){return O.from(r[n]).filter(function(t){return!h(i.anchor[n],t)})})("text"),target:n("target"),rel:n("rel"),class:n("linkClass"),title:n("title")},e={href:r.url.value,attach:void 0!==r.url.meta&&r.url.meta.attach?r.url.meta.attach:s},Tt(o,n).then(function(t){wt(o,e,t)})):S(o),t.close()},e=o=f,u=(t=i=t).anchor.text.map(function(){return{name:"text",type:"input",label:"Text to display"}}).toArray(),a=t.flags.titleEnabled?[{name:"title",type:"input",label:"Title"}]:[],e=e=O.from(y(e)),r=(r=t).anchor,l={url:{value:l=r.url.getOr(""),meta:{original:{value:l}}},text:r.text.getOr(""),title:r.title.getOr(""),anchor:l,link:l,rel:r.rel.getOr(""),target:r.target.or(e).getOr(""),linkClass:r.linkClass.getOr("")},e=t.catalogs,c=Nt(l,e),{title:"Insert/Edit Link",size:"normal",body:{type:"panel",items:st([[{name:"url",type:"urlinput",filetype:"file",label:"URL"}],u,a,function(t){for(var n=[],e=function(t){n.push(t)},r=0;r<t.length;r++)t[r].each(e);return n}([e.anchor.map(N.createUi("anchor","Anchors")),e.rels.map(N.createUi("rel","Rel")),e.targets.map(N.createUi("target","Open link in...")),e.link.map(N.createUi("link","Link list")),e.classes.map(N.createUi("linkClass","Class"))])])},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:l,onChange:function(n,t){t=t.name;c.onChange(n.getData,{name:t}).each(function(t){n.setData(t)})},onSubmit:n}}).then(function(t){f.windowManager.open(t)})}function it(t){var n=document.createElement("a");n.target="_blank",n.href=t,n.rel="noreferrer noopener",(t=document.createEvent("MouseEvents")).initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),n=n,t=t,document.body.appendChild(n),n.dispatchEvent(t),document.body.removeChild(n)}function b(t,n){return t.on("NodeChange",n),function(){return t.off("NodeChange",n)}}function ut(i){function t(t){var n=i.selection.getNode();return t.setDisabled(!P(i,n)),s}i.ui.registry.addContextForm("quicklink",{launch:{type:"contextformtogglebutton",icon:"link",tooltip:"Link",onSetup:M(i)},label:"Link",predicate:function(t){return!!P(i,t)&&mt(i)},initValue:function(){var t=P(i);return t?T(t):""},commands:[{type:"contextformtogglebutton",icon:"link",tooltip:"Link",primary:!0,onSetup:function(t){var n=i.selection.getNode();return t.setActive(!!P(i,n)),M(i)(t)},onAction:function(t){var n,e,r=t.getValue(),o=(n=r,o=P(i),e=Ot(i),!o&&e?(e=xt(i.selection,o),O.some(0<e.length?e:n)):O.none());wt(i,{href:r,attach:s},{href:r,text:o,title:O.none(),rel:O.none(),target:O.none(),class:O.none()}),i.selection.collapse(!1),t.hide()}},{type:"contextformbutton",icon:"unlink",tooltip:"Remove link",onSetup:t,onAction:function(t){S(i),t.hide()}},{type:"contextformbutton",icon:"new-tab",tooltip:"Open link",onSetup:t,onAction:function(t){E(i)(),t.hide()}}]})}var O={some:g,none:r,from:function(t){return null==t?f:g(t)}},at=Array.prototype.indexOf,lt=Array.prototype.push,ct=function(t,n){return at.call(t,n)},ft=function(t,n){for(var e=t.length,r=new Array(e),o=0;o<e;o++){var i=t[o];r[o]=n(i,o)}return r},st=function(t){for(var n=[],e=0,r=t.length;e<r;++e){if(!a(t[e]))throw new Error("Arr.flatten item "+e+" was not an array, input: "+t);lt.apply(n,t[e])}return n},mt=function(t){return t.getParam("link_context_toolbar",!1,"boolean")},gt=function(t){return t.getParam("link_quicklink",!1,"boolean")},w=tinymce.util.Tools.resolve("tinymce.util.Tools"),C=function(t){return u(t.value)?t.value:""},dt=function(t,r){var o=[];return w.each(t,function(t){var n,e=u((e=t).text)?e.text:u(e.title)?e.title:"";void 0!==t.menu?(n=dt(t.menu,r),o.push({text:e,items:n})):(n=r(t),o.push({text:e,value:n}))}),o},N={sanitize:function(t){return W(C)(t)},sanitizeWith:W,createUi:function(n,e){return function(t){return{name:n,type:"listbox",label:e,items:t}}},getValue:C},A=function(){return(A=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},ht=Object.keys,pt=Object.hasOwnProperty,vt=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),yt=tinymce.util.Tools.resolve("tinymce.util.URI"),kt=function(t){return/^\w+:/i.test(t)},T=function(t){var n=t.getAttribute("data-mce-href");return n||t.getAttribute("href")},P=function(t,n){return n=n||t.selection.getNode(),x(n)?t.dom.select("a[href]",n)[0]:t.dom.getParent(n,"a[href]")},xt=function(t,n){return(n?n.innerText||n.textContent:t.getContent({format:"text"})).replace(/\uFEFF/g,"")},bt=function(t){return 0<w.grep(t,J).length},Ot=function(t){var n=t.schema.getTextInlineElements();return 0===X(t.selection.getRng(),function(t){return 1===t.nodeType&&!G(t)&&!k(n,t.nodeName.toLowerCase())}).length},wt=function(t,n,e){r=t,o=e.href;var r,o,e=A(A({},e),{href:yt.isDomSafe(o,"a",r.settings)?o:""});t.hasPlugin("rtc",!0)?t.execCommand("createlink",!1,tt(e)):Y(t,n,e)},S=function(t){t.hasPlugin("rtc",!0)?t.execCommand("unlink"):Z(t)},Ct=function(n,t){return d(t,function(t){return nt(t)?Ct(n,t.items):p(t.value===n,t)})},Nt=function(t,o){function i(t,n){e=o;var e,r=("link"===(r=n.name)?e.link:"anchor"===r?e.anchor:O.none()).getOr([]);return et(u.text,n.name,r,t)}var u={text:t.text,title:t.title},a=function(t){return p(u.title.length<=0,O.from(t.meta.title).getOr(""))},l=function(t){return p(u.text.length<=0,O.from(t.meta.text).getOr(t.value))};return{onChange:function(t,n){var e,r,o=n.name;return"url"===o?(e=t(),r=l(e.url),e=a(e.url),r.isSome()||e.isSome()?O.some(A(A({},r.map(function(t){return{text:t}}).getOr({})),e.map(function(t){return{title:t}}).getOr({}))):O.none()):-1<ct(["anchor","link"],o)?i(t(),n):(("text"===o||"title"===o)&&(u[o]=t()[o]),O.none())}}},At=tinymce.util.Tools.resolve("tinymce.util.Delay"),_=tinymce.util.Tools.resolve("tinymce.util.Promise"),Tt=function(u,a){return d([rt,(e=v(u),r=u.getParam("link_default_protocol","http","string"),function(t){var n=t.href;return 1===e&&!kt(n)||0===e&&/^\s*www(\.|\d\.)/i.test(n)?O.some({message:"The URL you entered seems to be an external link. Do you want to add the required "+r+":// prefix?",preprocess:function(t){return A(A({},t),{href:r+"://"+n})}}):O.none()})],function(t){return t(a)}).fold(function(){return _.resolve(a)},function(i){return new _(function(n){var e,t,r,o;e=u,t=i.message,r=function(t){n(t?i.preprocess(a):a)},o=e.selection.getRng(),At.setEditorTimeout(e,function(){e.windowManager.confirm(t,function(t){e.selection.setRng(o),r(t)})})})});var e,r},Pt=function(t){t=t.dom.select("a:not([href])"),t=st(ft(t,function(t){t=t.name||t.id;return t?[{text:t,value:"#"+t}]:[]}));return 0<t.length?O.some([{text:"None",value:""}].concat(t)):O.none()},St=function(t){t=t.getParam("link_class_list",[],"array");return 0<t.length?N.sanitize(t):O.none()},_t=tinymce.util.Tools.resolve("tinymce.util.XHR"),Rt=function(n){function e(t){return n.convertURL(t.value||t.url,"href")}var t=n.getParam("link_list");return new _(function(n){u(t)?_t.send({url:t,success:function(t){return n(function(t){try{return O.some(JSON.parse(t))}catch(t){return O.none()}}(t))},error:function(t){return n(O.none())}}):z(t)?t(function(t){return n(O.some(t))}):n(O.from(t))}).then(function(t){return t.bind(N.sanitizeWith(e)).map(function(t){return 0<t.length?[{text:"None",value:""}].concat(t):t})})},Dt=function(t,n){var e,r=q(t);return 0<r.length?(e=h(n,"_blank"),(!1===F(t)?N.sanitizeWith(function(t){return $(N.getValue(t),e)}):N.sanitize)(r)):O.none()},Lt=[{text:"Current window",value:""},{text:"New window",value:"_blank"}],Et=function(t){t=V(t);return a(t)?N.sanitize(t).orThunk(function(){return O.some(Lt)}):!1===t?O.none():O.some(Lt)},R=function(t,n,e){t=t.getAttrib(n,e);return null!==t&&0<t.length?O.some(t):O.none()},Mt=function(l,c){return Rt(l).then(function(t){e=c,r=(n=l).dom,n=Ot(n)?O.some(xt(n.selection,e)):O.none(),a=e?O.some(r.getAttrib(e,"href")):O.none(),o=e?O.from(r.getAttrib(e,"target")):O.none(),i=R(r,e,"rel"),u=R(r,e,"class");var n,e,r,o,i,u,a={url:a,text:n,title:R(r,e,"title"),target:o,rel:i,linkClass:u};return{anchor:a,catalogs:{targets:Et(l),rels:Dt(l,a.target),classes:St(l),anchor:Pt(l),link:t},optNode:O.from(c),flags:{titleEnabled:l.getParam("link_title",!0,"boolean")}}})},Ut=function(t,n){return t.dom.getParent(n,"a[href]")},Bt=function(t){return Ut(t,t.selection.getStart())},It=function(t){return!0===t.altKey&&!1===t.shiftKey&&!1===t.ctrlKey&&!1===t.metaKey},D=function(t,n){var e;n&&(e=T(n),/^#/.test(e)?(e=t.$(e)).length&&t.selection.scrollIntoView(e[0],!0):it(n.href))},L=function(t){return function(){ot(t)}},E=function(t){return function(){D(t,Bt(t))}},M=function(e){return function(t){function n(){return t.setActive(!e.mode.isReadOnly()&&null!==P(e,e.selection.getNode()))}return n(),b(e,n)}},Kt=function(e){return function(t){function n(){return t.setDisabled(null===P(e,e.selection.getNode()))}return n(),b(e,n)}},zt=function(r){return function(n){function e(t){return bt(t)||(t=r.selection.getRng(),0<X(t,J).length)}var t=r.dom.getParents(r.selection.getStart());return n.setDisabled(!e(t)),b(r,function(t){return n.setDisabled(!e(t.parents))})}};U.add("link",function(t){var n,e,r,o,i,u;(n=t).ui.registry.addToggleButton("link",{icon:"link",tooltip:"Insert/edit link",onAction:L(n),onSetup:M(n)}),n.ui.registry.addButton("openlink",{icon:"new-tab",tooltip:"Open link",onAction:E(n),onSetup:Kt(n)}),n.ui.registry.addButton("unlink",{icon:"unlink",tooltip:"Remove link",onAction:function(){return S(n)},onSetup:zt(n)}),(e=t).ui.registry.addMenuItem("openlink",{text:"Open link",icon:"new-tab",onAction:E(e),onSetup:Kt(e)}),e.ui.registry.addMenuItem("link",{icon:"link",text:"Link...",shortcut:"Meta+K",onAction:L(e)}),e.ui.registry.addMenuItem("unlink",{icon:"unlink",text:"Remove link",onAction:function(){return S(e)},onSetup:zt(e)}),(r=t).ui.registry.addContextMenu("link",{update:function(t){return bt(r.dom.getParents(t,"a"))?"link unlink openlink":"link"}}),ut(t),(o=t).on("click",function(t){var n=Ut(o,t.target);n&&B.metaKeyPressed(t)&&(t.preventDefault(),D(o,n))}),o.on("keydown",function(t){var n=Bt(o);n&&13===t.keyCode&&It(t)&&(t.preventDefault(),D(o,n))}),(i=t).addCommand("mceLink",function(){gt(i)?i.fire("contexttoolbar-show",{toolbarKey:"quicklink"}):L(i)()}),(u=t).addShortcut("Meta+K","",function(){u.execCommand("mceLink")})})}();