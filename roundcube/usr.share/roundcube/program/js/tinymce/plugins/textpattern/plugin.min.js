!function(){"use strict";var j=tinymce.util.Tools.resolve("tinymce.PluginManager"),i=function(){return(i=Object.assign||function(t){for(var n,r=1,e=arguments.length;r<e;r++)for(var o in n=arguments[r])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)};function c(t,n,r){if(r||2===arguments.length)for(var e,o=0,a=n.length;o<a;o++)!e&&o in n||((e=e||Array.prototype.slice.call(n,0,o))[o]=n[o]);return t.concat(e||Array.prototype.slice.call(n))}function t(r){return function(t){return n=typeof(t=t),(null===t?"null":"object"==n&&(Array.prototype.isPrototypeOf(t)||t.constructor&&"Array"===t.constructor.name)?"array":"object"==n&&(String.prototype.isPrototypeOf(t)||t.constructor&&"String"===t.constructor.name)?"string":n)===r;var n}}function n(){}function a(t){return function(){return t}}function e(t){return t}function r(){return d}var u=t("string"),_=t("object"),f=t("array"),s=a(!1),l=a(!0),d={fold:function(t,n){return t()},isSome:s,isNone:l,getOr:e,getOrThunk:o,getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},getOrNull:a(null),getOrUndefined:a(void 0),or:e,orThunk:o,map:r,each:n,bind:r,exists:s,forall:l,filter:function(){return d},toArray:function(){return[]},toString:a("none()")};function o(t){return t()}function m(r){function t(){return o}function n(t){return t(r)}var e=a(r),o={fold:function(t,n){return n(r)},isSome:l,isNone:s,getOr:e,getOrThunk:e,getOrDie:e,getOrNull:e,getOrUndefined:e,or:t,orThunk:t,map:function(t){return m(t(r))},each:function(t){t(r)},bind:n,exists:n,forall:n,filter:function(t){return t(r)?o:d},toArray:function(){return[r]},toString:function(){return"some("+r+")"}};return o}function g(t,n){return-1<dt(t,n)}function p(t,n){for(var r=[],e=0,o=t.length;e<o;e++){var a=t[e];n(a,e)&&r.push(a)}return r}function h(t,r,e){for(var n=t,o=function(t,n){e=r(e,t,n)},a=n.length-1;0<=a;a--)o(n[a],a);return e}function U(t,n){for(var r=t,e=n,o=s,a=0,i=r.length;a<i;a++){var u=r[a];if(e(u,a))return N.some(u);if(o(u,a))break}return N.none()}function L(t,n){for(var r=0,e=t.length;r<e;++r)if(!0!==n(t[r],r))return!1;return!0}function V(t){return t=t,(n=0)<=n&&n<t.length?N.some(t[n]):N.none();var n}function v(r){return{isValue:l,isError:s,getOr:a(r),getOrThunk:a(r),getOrDie:a(r),or:function(t){return v(r)},orThunk:function(t){return v(r)},fold:function(t,n){return n(r)},map:function(t){return v(t(r))},mapError:function(t){return v(r)},each:function(t){t(r)},bind:function(t){return t(r)},exists:function(t){return t(r)},forall:function(t){return t(r)},toOptional:function(){return N.some(r)}}}function y(r){return{isValue:s,isError:l,getOr:e,getOrThunk:function(t){return t()},getOrDie:function(){throw t=String(r),new Error(t);var t},or:e,orThunk:function(t){return t()},fold:function(t,n){return t(r)},map:function(t){return y(r)},mapError:function(t){return y(t(r))},each:n,bind:function(t){return y(r)},exists:s,forall:l,toOptional:N.none}}function W(t){return"inline-command"===t.type||"inline-format"===t.type}function q(t){return"block-command"===t.type||"block-format"===t.type}function z(t){var n=function(t,n){return t.start.length===n.start.length?0:t.start.length>n.start.length?-1:1};return(t=st.call(t,0)).sort(n),t}function F(t){return!1===(t=t.getParam("forced_root_block","p"))?"":!0===t?"p":t}function b(t,n){return{container:t,offset:n}}function k(t){return t.nodeType===Node.TEXT_NODE}function O(t,n,r){var e;n&&t.isEmpty(n)&&!r(n)&&(e=n.parentNode,t.remove(n),O(t,e,r))}function w(t,n,r,e){void 0===e&&(e=!0);var o=n.startContainer.parentNode,a=n.endContainer.parentNode;n.deleteContents(),e&&!r(n.startContainer)&&(k(n.startContainer)&&0===n.startContainer.data.length&&t.remove(n.startContainer),k(n.endContainer)&&0===n.endContainer.data.length&&t.remove(n.endContainer),O(t,o,r),o!==a)&&O(t,a,r)}function G(t,n){return n=n.get(t),f(n)&&V(n).exists(function(t){return n="block",gt.call(t,n);var n})}function C(t){return 0===t.start.length}function E(t,n){return n=N.from(t.dom.getParent(n.startContainer,t.dom.isBlock)),""===F(t)?n.orThunk(function(){return N.some(t.getBody())}):n}function x(n){return function(t){return n===t?-1:0}}function R(t,r,e){var n;return k(t)?(n=t.textContent,0<=r&&r<=n.length?N.some(b(t,r)):(n=B(D),N.from(n.backwards(t,r,x(t),e)).bind(function(t){var n=t.container.data;return R(t.container,r+n.length,e)}))):N.none()}function H(t,n,r){var e,o;return k(t)?(e=t.textContent,n<=e.length?N.some(b(t,n)):(o=B(D),N.from(o.forwards(t,n,x(t),r)).bind(function(t){return H(t.container,n-e.length,r)}))):N.none()}function J(t,n,r,e,o){var a,t=B(t,(a=t,function(t){return a.isBlock(t)||g(["BR","IMG","HR","INPUT"],t.nodeName)||"false"===a.getContentEditable(t)}));return N.from(t.backwards(n,r,e,o))}function K(t,n,r){if(k(n)&&(r<0||r>n.data.length))return[];for(var e=[r],o=n;o!==t&&o.parentNode;){for(var a=o.parentNode,i=0;i<a.childNodes.length;i++)if(a.childNodes[i]===o){e.push(i);break}o=a}return o===t?e.reverse():[]}function T(t,n,r,e,o){return{start:K(t,n,r),end:K(t,e,o)}}function X(t,n){var r,e,o=(n=n.slice()).pop();return n=n,r=function(t,n){return t.bind(function(t){return N.from(t.childNodes[n])})},e=N.some(t),M(n,function(t,n){e=r(e,t,n)}),e.bind(function(t){return k(t)&&(o<0||o>t.data.length)?N.none():N.some({node:t,offset:o})})}function Q(n,r){return X(n,r.start).bind(function(t){var e=t.node,o=t.offset;return X(n,r.end).map(function(t){var n=t.node,t=t.offset,r=document.createRange();return r.setStart(e,o),r.setEnd(n,t),r})})}function Y(e,o,n){var t,r,a,i;r=0,a=t=o,(k(t)&&r>=t.length?N.some(b(t,r)):(i=B(D),N.from(i.forwards(t,r,x(t),a)).map(function(t){return b(t.container,0)}))).each(function(t){var r=t.container;H(r,n.start.length,o).each(function(t){var n=e.createRng();n.setStart(r,0),n.setEnd(t.container,t.offset),w(e,n,function(t){return t===o})})})}function Z(r,a){var i=r.dom,t=r.selection.getRng();return E(r,t).filter(function(t){var n=F(r),n=""===n&&i.is(t,"body")||i.is(t,n);return null!==t&&n}).bind(function(n){var t,r,e,o=n.textContent;return t=a,e=(r=o).replace("Â "," "),U(t,function(t){return 0===r.indexOf(t.start)||0===e.indexOf(t.start)}).map(function(t){return xt.trim(o).length===t.start.length?[]:[{pattern:t,range:T(i.getRoot(),n,0,n,0)}]})}).getOr([])}function $(o,t){var n;0!==t.length&&(n=o.selection.getBookmark(),M(t,function(t){return t=t,r=(n=o).dom,e=t.pattern,r=Q(r.getRoot(),t.range).getOrDie("Unable to resolve path range"),E(n,r).each(function(t){"block-format"===e.type?G(e.format,n.formatter)&&n.undoManager.transact(function(){Y(n.dom,t,e),n.formatter.apply(e.format)}):"block-command"===e.type&&n.undoManager.transact(function(){Y(n.dom,t,e),n.execCommand(e.cmd,!1,e.value)})}),!0;var n,r,e}),o.selection.moveToBookmark(n))}function tt(t,n){return t.create("span",{"data-mce-type":"bookmark",id:n})}function P(t,n){return(t=t.createRng()).setStartAfter(n.start),t.setEndBefore(n.end),t}function nt(t,n,r){var e=(r=Q(t.getRoot(),r).getOrDie("Unable to resolve path range")).startContainer,o=r.endContainer,o=0===r.endOffset?o:o.splitText(r.endOffset),e=0===r.startOffset?e:e.splitText(r.startOffset);return{prefix:n,end:o.parentNode.insertBefore(tt(t,n+"-end"),o),start:e.parentNode.insertBefore(tt(t,n+"-start"),e)}}function rt(t,n,r){O(t,t.get(n.prefix+"-end"),r),O(t,t.get(n.prefix+"-start"),r)}function et(e,n,o,t){var r,a=n.start;return J(e,t.container,t.offset,(r=a,function(t,n){t=t.data.substring(0,n),n=t.lastIndexOf(r.charAt(r.length-1)),t=t.lastIndexOf(r);return-1!==t?t+r.length:-1!==n?n+1:-1}),o).bind(function(r){var t;return r.offset>=a.length?((t=e.createRng()).setStart(r.container,r.offset-a.length),t.setEnd(r.container,r.offset),N.some(t)):(t=r.offset-a.length,R(r.container,t,o).map(function(t){var n=e.createRng();return n.setStart(t.container,t.offset),n.setEnd(r.container,r.offset),n}).filter(function(t){return t.toString()===a}).orThunk(function(){return et(e,n,o,b(r.container,0))}))})}function ot(i,u,c,f,s){var l=i.dom;return I(c,f,l.getRoot()).bind(function(t){for(var n=l.createRng(),r=(n.setStart(s,0),n.setEnd(c,f),n.toString()),e=0;e<u.length;e++){var o=u[e];if(Pt(r,o.end)){var a=u.slice(),o=(a.splice(e,1),Nt(i,s,{pattern:o,remainingPatterns:a,position:t}));if(o.isSome())return o}}return N.none()})}function at(n,t,r){n.selection.setRng(r),"inline-format"===t.type?M(t.format,function(t){n.formatter.apply(t)}):n.execCommand(t.cmd,!1,t.value)}function it(e,t){n="mce_textpattern",r=(new Date).getTime();var n,r,o=n+"_"+Math.floor(1e9*Math.random())+ ++Tt+String(r),a=h(t,function(t,n){var r=nt(e,o+"_end"+t.length,n.endRng);return t.concat([i(i({},n),{endMarker:r})])},[]);return h(a,function(t,n){var r=a.length-t.length-1,r=C(n.pattern)?n.endMarker:nt(e,o+"_start"+r,n.startRng);return t.concat([i(i({},n),{startMarker:r})])},[])}function ut(r,e,o){var a=r.selection.getRng();return!1===a.collapsed?[]:E(r,a).bind(function(t){var n=a.startOffset-(o?1:0);return ot(r,e,a.startContainer,n,t)}).fold(function(){return[]},function(t){return t.matches})}function ct(l,t){var d,n;0!==t.length&&(d=l.dom,n=l.selection.getBookmark(),t=it(d,t),M(t,function(t){function n(t){return t===s}var r,e,o,a,i,u,c,f,s=d.getParent(t.startMarker.start,d.isBlock);C(t.pattern)?(e=l,o=t.pattern,a=t.endMarker,r=n,a=P(e.dom,a),w(e.dom,a,r),at(e,o,a)):(r=l,e=t.pattern,o=t.startMarker,a=t.endMarker,i=n,u=r.dom,c=P(u,a),f=P(u,o),w(u,f,i),w(u,c,i),f={prefix:o.prefix,start:o.end,end:a.start},c=P(u,f),at(r,e,c)),rt(d,t.endMarker,n),rt(d,t.startMarker,n)}),l.selection.moveToBookmark(n))}function ft(t,n,r){for(var e=0;e<t.length;e++)if(r(t[e],n))return!0;return!1}var N={some:m,none:r,from:function(t){return null==t?d:m(t)}},st=Array.prototype.slice,lt=Array.prototype.indexOf,dt=function(t,n){return lt.call(t,n)},S=function(t,n){for(var r=t.length,e=new Array(r),o=0;o<r;o++){var a=t[o];e[o]=n(a,o)}return e},M=function(t,n){for(var r=0,e=t.length;r<e;r++)n(t[r],r)},mt=Object.keys,gt=Object.hasOwnProperty,pt=(function(i){if(!f(i))throw new Error("cases must be an array");if(0===i.length)throw new Error("there must be at least one case");var u=[],r={};return M(i,function(t,e){var n=mt(t);if(1!==n.length)throw new Error("one and only one name per case");var o=n[0],a=t[o];if(void 0!==r[o])throw new Error("duplicate key detected:"+o);if("cata"===o)throw new Error("cannot have a case named cata (sorry)");if(!f(a))throw new Error("case arguments must be an array");u.push(o),r[o]=function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var n=r.length;if(n!==a.length)throw new Error("Wrong number of arguments to case "+o+". Expected "+a.length+" ("+a+"), got "+n);return{fold:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(t.length!==i.length)throw new Error("Wrong number of arguments to fold. Expected "+i.length+", got "+t.length);return t[e].apply(null,r)},match:function(t){var n=mt(t);if(u.length!==n.length)throw new Error("Wrong number of arguments to match. Expected: "+u.join(",")+"\nActual: "+n.join(","));if(L(u,function(t){return g(n,t)}))return t[o].apply(null,r);throw new Error("Not all branches were specified when using match. Specified: "+n.join(", ")+"\nRequired: "+u.join(", "))},log:function(t){console.log(t,{constructors:u,constructor:o,params:r})}}}}),r}([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]),function(t){var n=[],r=[];return M(t,function(t){t.fold(function(t){n.push(t)},function(t){r.push(t)})}),{errors:n,values:r}}),A=v,ht=y,vt=function(e){function o(t){return ht({message:t,pattern:e})}function t(t,n,r){if(void 0===e.format)return void 0!==e.cmd?u(e.cmd)?A(r(e.cmd,e.value)):o(t+" pattern has non-string `cmd` parameter"):o(t+" pattern is missing both `format` and `cmd` parameters");if(r=void 0,f(e.format)){if(!L(e.format,u))return o(t+" pattern has non-string items in the `format` array");r=e.format}else{if(!u(e.format))return o(t+" pattern has non-string `format` parameter");r=[e.format]}return A(n(r))}var r,a;return _(e)?u(e.start)?void 0!==e.end?u(e.end)?0===e.start.length&&0===e.end.length?o("Inline pattern has empty `start` and `end` parameters"):(r=e.start,0===(a=e.end).length&&(a=r,r=""),t("Inline",function(t){return{type:"inline-format",start:r,end:a,format:t}},function(t,n){return{type:"inline-command",start:r,end:a,cmd:t,value:n}})):o("Inline pattern has non-string `end` parameter"):void 0!==e.replacement?u(e.replacement)?0===e.start.length?o("Replacement pattern has empty `start` parameter"):A({type:"inline-command",start:"",end:e.start,cmd:"mceInsertContent",value:e.replacement}):o("Replacement pattern has non-string `replacement` parameter"):0===e.start.length?o("Block pattern has empty `start` parameter"):t("Block",function(t){return{type:"block-format",start:e.start,format:t[0]}},function(t,n){return{type:"block-command",start:e.start,cmd:t,value:n}}):o("Raw pattern is missing `start` parameter"):o("Raw pattern is not an object")},yt=function(t){return"block-command"===t.type?{start:t.start,cmd:t.cmd,value:t.value}:"block-format"===t.type?{start:t.start,format:t.format}:"inline-command"===t.type?"mceInsertContent"===t.cmd&&""===t.start?{start:t.end,replacement:t.value}:{start:t.start,end:t.end,cmd:t.cmd,value:t.value}:"inline-format"===t.type?{start:t.start,end:t.end,format:1===t.format.length?t.format[0]:t.format}:void 0},bt=function(t){return{inlinePatterns:p(t,W),blockPatterns:z(p(t,q))}},kt="undefined"!=typeof window?window:Function("return this;")(),Ot=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=kt.console;r&&(r.error||r.log).apply(r,t)},wt=[{start:"*",end:"*",format:"italic"},{start:"**",end:"**",format:"bold"},{start:"#",format:"h1"},{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:"1. ",cmd:"InsertOrderedList"},{start:"* ",cmd:"InsertUnorderedList"},{start:"- ",cmd:"InsertUnorderedList"}],Ct=tinymce.util.Tools.resolve("tinymce.util.Delay"),Et=tinymce.util.Tools.resolve("tinymce.util.VK"),xt=tinymce.util.Tools.resolve("tinymce.util.Tools"),Rt=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),B=tinymce.util.Tools.resolve("tinymce.dom.TextSeeker"),D=Rt.DOM,I=function(t,n,r){var e;return k(t)&&0<=n?N.some(b(t,n)):(e=B(D),N.from(e.backwards(t,n,x(t),r)).map(function(t){return b(t.container,t.container.data.length)}))},Tt=0,Pt=function(t,n){return r=n,n=(t=t).length-n.length,""===r||t.length>=r.length&&t.substr(n,n+r.length)===r;var r},Nt=function(f,s,l){var d=f.dom,m=d.getRoot(),g=l.pattern,p=l.position.container,h=l.position.offset;return R(p,h-l.pattern.end.length,s).bind(function(t){var r,e,o,n,a,i,u,c=T(m,t.container,t.offset,p,h);return C(g)?N.some({matches:[{pattern:g,startRng:c,endRng:c}],position:t}):(u=ot(f,l.remainingPatterns,t.container,t.offset,s),t=(r=u.getOr({matches:[],position:t})).position,e=d,o=g,n=t.container,t=t.offset,a=s,void 0===(i=u.isNone())&&(i=!1),(0!==o.start.length||i?I(n,t,a).bind(function(n){return et(e,o,a,n).bind(function(t){if(i){if(t.endContainer===n.container&&t.endOffset===n.offset)return N.none();if(0===n.offset&&t.endContainer.textContent.length===t.endOffset)return N.none()}return N.some(t)})}):((u=e.createRng()).setStart(n,t),u.setEnd(n,t),N.some(u))).map(function(t){var n=T(m,t.startContainer,t.startOffset,t.endContainer,t.endOffset);return{matches:r.matches.concat([{pattern:g,startRng:n,endRng:c}]),position:b(t.startContainer,t.startOffset)}}))})},St=function(r,t){var n,e;return!!r.selection.isCollapsed()&&(n=ut(r,t.inlinePatterns,!1),0<(e=Z(r,t.blockPatterns)).length||0<n.length)&&(r.undoManager.add(),r.undoManager.extra(function(){r.execCommand("mceInsertNewLine")},function(){r.insertContent("\ufeff",{preserve_zwsp:!0}),ct(r,n),$(r,e);var t=r.selection.getRng(),t=I(t.startContainer,t.startOffset,r.dom.getRoot());r.execCommand("mceInsertNewLine"),t.each(function(t){var n=t.container;"\ufeff"===n.data.charAt(t.offset-1)&&(n.deleteData(t.offset-1,1),O(r.dom,n.parentNode,function(t){return t===r.dom.getRoot()}))})}),!0)},Mt=function(t,n){var r=ut(t,n.inlinePatterns,!0);0<r.length&&t.undoManager.transact(function(){ct(t,r)})},At=function(t,n){return ft(t,n,function(t,n){return t===n.keyCode&&!1===Et.modifierPressed(n)})},Bt=function(t,n){return ft(t,n,function(t,n){return t.charCodeAt(0)===n.charCode})};j.add("textpattern",function(t){u=(u=t).getParam("textpattern_patterns",wt,"array"),u=f(u)?(u=pt(S(u,vt)),M(u.errors,function(t){return Ot(t.message,t.pattern)}),bt(u.values)):(Ot("The setting textpattern_patterns should be an array"),{inlinePatterns:[],blockPatterns:[]}),n=u;var n,r,e,o,a,i,u={get:function(){return n},set:function(t){n=t}};return e=u,o=[",",".",";",":","!","?"],a=[32],(r=t).on("keydown",function(t){13!==t.keyCode||Et.modifierPressed(t)||St(r,e.get())&&t.preventDefault()},!0),r.on("keyup",function(t){At(a,t)&&Mt(r,e.get())}),r.on("keypress",function(t){Bt(o,t)&&Ct.setEditorTimeout(r,function(){Mt(r,e.get())})}),i=u,{setPatterns:function(t){var n,t=pt(S(t,vt));if(0<t.errors.length)throw n=t.errors[0],new Error(n.message+":\n"+JSON.stringify(n.pattern,null,2));i.set(bt(t.values))},getPatterns:function(){return c(c([],S(i.get().inlinePatterns,yt),!0),S(i.get().blockPatterns,yt),!0)}}})}();